<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Integrated Circuits</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'> -->
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <script src='main.js'></script>
    <style>
        div#appContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: auto;
        }
    </style>
</head>

<body>
    <div id="appContainer"></div>
    <script>
        const STATES = {
            LOW: false,
            HIGH: true
        };

        const configs = {
            canvas: {
                ic_width: 60,
                background: "#E0E0E0",
                margin_horizontal: 20,
                margin_vertical: 5,
                ic_background: "#FFFFFF",
                pin_width: 20,
                pin_height: 15,
                pin_vertical_margin: 5,
                pin_text_margin_horizontal: 5,
                pin_HIGH_bakcground: "#20F020",
                pin_LOW_bakcground: "#F02020",
                pin_VCC_background: "#8FBC8F",
                pin_GND_background: "#FFD700"
            }
        };

        const PIN_TYPES = {
            INPUT: "input",
            OUTPUT: "output",
            GND: "GND",
            VCC: "VCC"
        };

        function getPinBackground(pin) {

            if (pin.type === PIN_TYPES.VCC) {
                return configs.canvas.pin_VCC_background;
            } else if (pin.type === PIN_TYPES.GND) {
                return configs.canvas.pin_GND_background;
            } else {
                return pin.state ? configs.canvas.pin_HIGH_bakcground : configs.canvas.pin_LOW_bakcground;
            }
        }

        function drawPin(ctx, pins, rowIndex, isRight, textY, nameHorizontalMargin, pinNumberCenter, x, y, canvasWidth) {
            const pin = pins[isRight ? pins.length - rowIndex - 1 : rowIndex];
            const pinNumber = isRight ? pins.length - rowIndex : rowIndex + 1;
            const pinPos = [
                x,y,
                configs.canvas.pin_width,
                configs.canvas.pin_height
            ];

            ctx.fillStyle = getPinBackground(pin);
            ctx.fillRect(...pinPos);
            ctx.strokeRect(...pinPos);

            ctx.fillStyle = "#000";
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(pinNumber, isRight ? canvasWidth - pinNumberCenter : pinNumberCenter, textY);

            ctx.textAlign = isRight ? "end" : "start";
            ctx.fillText(pin.name || pin.type, isRight ? canvasWidth - nameHorizontalMargin : nameHorizontalMargin, textY);
            pin.pos = { 
                x, 
                y, 
                h: configs.canvas.pin_width, 
                w: configs.canvas.pin_height 
            };
        }

        function drawICPins(pins, ctx, canvasWidth, canvasHeight, pinTotalHeight) {
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            const horizontalMargin = configs.canvas.pin_width + configs.canvas.margin_horizontal;

            ctx.fillStyle = configs.canvas.ic_background;
            const icRect = [
                horizontalMargin,
                configs.canvas.margin_vertical,
                canvasWidth - 2 * horizontalMargin,
                canvasHeight - 2 * configs.canvas.margin_vertical
            ];
            ctx.fillRect(...icRect);
            ctx.strokeRect(...icRect);

            let pinVerticalStart = configs.canvas.pin_vertical_margin + configs.canvas.margin_vertical; //{ configs.canvas.margin_horizontal };
            let nameHorizontalMargin = configs.canvas.margin_horizontal + configs.canvas.pin_width + configs.canvas.pin_text_margin_horizontal;
            const pinNumberCenter = configs.canvas.margin_horizontal + configs.canvas.pin_width / 2;
            for (let pinIndex = 0; pinIndex < pins.length / 2; pinIndex++) {
                const textY = pinVerticalStart + configs.canvas.pin_height / 2;

                drawPin(ctx, pins, pinIndex, false, textY,nameHorizontalMargin, pinNumberCenter, 
                    configs.canvas.margin_horizontal,
                    pinVerticalStart, canvasWidth);


                drawPin(ctx, pins, pinIndex, true, textY, nameHorizontalMargin, pinNumberCenter,  
                    canvasWidth - configs.canvas.margin_horizontal - configs.canvas.pin_width,
                    pinVerticalStart, canvasWidth);

                pinVerticalStart += pinTotalHeight;
            }
        }

        function drawIC(definition, targetElement) {
            const pins = definition.pins;
            if (!pins || !pins.length || pins.length % 2) {
                console.log("Pin count not devidable by 2, " + JSON.stringify(pins));
                return;
            }
            const title = document.createElement("span");
            title.innerText = definition.name;
            targetElement.appendChild(title);

            const canvas = document.createElement("canvas");
            const pinTotalHeight = configs.canvas.pin_height + (2 * configs.canvas.pin_vertical_margin);
            const canvasHeight = (pins.length / 2) * pinTotalHeight + 2 * configs.canvas.margin_vertical;
            const canvasWidth = configs.canvas.ic_width + 2 * (configs.canvas.margin_horizontal + configs.canvas.pin_width);
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            canvas.style.background = configs.canvas.background;
            targetElement.appendChild(canvas);

            const ctx = canvas.getContext("2d");

            drawICPins(pins, ctx, canvasWidth, canvasHeight, pinTotalHeight);

            const canvasLeft = canvas.offsetLeft;
            const canvasTop = canvas.offsetTop;

            canvas.onclick = function (event) {
                var x = event.pageX - canvasLeft,
                    y = event.pageY - canvasTop;

                pins.forEach(function (pin) {
                    if (pin.type !== PIN_TYPES.INPUT) {
                        return;
                    }
                    if (y > pin.pos.y && y < pin.pos.y + pin.pos.h && x > pin.pos.x && x < pin.pos.x + pin.pos.w) {
                        pin.state = !pin.state;
                    }
                });
                definition.update(pins);
                drawICPins(pins, ctx, canvasWidth, canvasHeight, pinTotalHeight);
            };
        }

        const container = document.getElementById("appContainer");

        function ic74x00_NAND() {
            this.pins = [
                {
                    name: "A1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y1",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A2",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B2",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y2",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    type: PIN_TYPES.GND
                },
                {
                    name: "Y3",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y4",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A4",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B4",
                    type: PIN_TYPES.INPUT
                },
                {
                    type: PIN_TYPES.VCC
                }
            ];

            function nand(a, b, y) {
                y.state = !(a.state && b.state);
            }

            function setStates(pins) {
                nand(pins[0], pins[1], pins[2]);
                nand(pins[3], pins[4], pins[5]);
                nand(pins[8], pins[9], pins[7]);
                nand(pins[11], pins[12], pins[10]);
            };

            setStates(this.pins);
            this.id = "74x00";
            this.name = "74x00 - NAND";
            this.update = setStates;
            this.datasheet = "http://www.ti.com/lit/ds/symlink/sn74ls00.pdf";
        }

        function ic74x02_NOR() {
            this.pins = [
                {
                    name: "Y1",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y2",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A2",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B2",
                    type: PIN_TYPES.INPUT
                },
                {
                    type: PIN_TYPES.GND
                },
                {
                    name: "A3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y3",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A4",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B4",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y4",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    type: PIN_TYPES.VCC
                }
            ];

            function nor(a, b, y) {
                y.state = !(a.state || b.state);
            }

            function setStates(pins) {
                nor(pins[1], pins[2], pins[0]);
                nor(pins[4], pins[5], pins[3]);
                nor(pins[7], pins[8], pins[9]);
                nor(pins[10], pins[11], pins[12]);
            };

            setStates(this.pins);
            this.id = "74x02";
            this.name = "74x02 - NOR";
            this.update = setStates;
            this.datasheet = "http://www.ti.com/lit/ds/symlink/sn74ls02.pdf";
        }

        function ic74x04_NOT() {
            this.pins = [
                {
                    name: "A1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y1",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A2",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y2",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y3",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    type: PIN_TYPES.GND
                },
                {
                    name: "Y4",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A4",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y5",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A5",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y6",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A6",
                    type: PIN_TYPES.INPUT
                },
                {
                    type: PIN_TYPES.VCC
                }
            ];

            function setStates(pins) {
                pins[1].state = !pins[0].state;
                pins[3].state = !pins[2].state;
                pins[5].state = !pins[4].state;
                pins[7].state = !pins[8].state;
                pins[9].state = !pins[10].state;
                pins[11].state = !pins[12].state;
            };

            setStates(this.pins);
            this.id = "74x04";
            this.name = "74x04 - NOT";
            this.update = setStates;
            this.datasheet = "http://www.ti.com/lit/ds/symlink/sn74ls04.pdf";
        }

        function ic74x08_AND() {
            this.pins = [
                {
                    name: "A1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B1",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y1",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A2",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B2",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y2",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    type: PIN_TYPES.GND
                },
                {
                    name: "Y3",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B3",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "Y4",
                    type: PIN_TYPES.OUTPUT
                },
                {
                    name: "A4",
                    type: PIN_TYPES.INPUT
                },
                {
                    name: "B4",
                    type: PIN_TYPES.INPUT
                },
                {
                    type: PIN_TYPES.VCC
                }
            ];

            function and(a, b, y) {
                y.state = a.state && b.state;
            }

            function setStates(pins) {
                and(pins[0], pins[1], pins[2]);
                and(pins[3], pins[4], pins[5]);
                and(pins[8], pins[9], pins[7]);
                and(pins[11], pins[12], pins[10]);
            };

            setStates(this.pins);
            this.id = "74x08";
            this.update = setStates;
            this.name = "74x08 - AND";
            this.datasheet = "http://www.ti.com/lit/ds/symlink/sn74ls08.pdf";
        }

        const ics = [
            new ic74x00_NAND(),
            new ic74x02_NOR(),
            new ic74x04_NOT(),
            new ic74x08_AND()
        ];
        ics.forEach(ic => drawIC(ic, container));
        //drawIC(new ic74x08_AND(), container);
    </script>
</body>

</html>